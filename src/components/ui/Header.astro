---
const currentPath = Astro.url.pathname;
const isActive = (path: string) => currentPath === path || currentPath.startsWith(path + '/');
---

<header class="border-b border-[var(--color-border)] bg-[var(--color-bg)] sticky top-0 z-50">
  <div class="max-w-6xl mx-auto px-4">
    <div class="flex items-center justify-between h-14">
      <a href="/" class="flex items-center gap-2 font-bold text-lg text-[var(--color-primary)]">
        <svg class="w-7 h-7" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" rx="6" fill="currentColor"/>
          <rect x="6" y="18" width="4" height="8" rx="1" fill="white" opacity="0.7"/>
          <rect x="12" y="13" width="4" height="13" rx="1" fill="white" opacity="0.8"/>
          <rect x="18" y="9" width="4" height="17" rx="1" fill="white" opacity="0.9"/>
          <rect x="24" y="6" width="4" height="20" rx="1" fill="white"/>
          <path d="M7 17L13 12L19 8L25 5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.6"/>
        </svg>
        PlainCost
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
        <a href="/metro" class:list={['hover:text-[var(--color-primary)] transition-colors', isActive('/metro') ? 'text-[var(--color-primary)]' : 'text-[var(--color-text-secondary)]']}>Metros</a>
        <a href="/state" class:list={['hover:text-[var(--color-primary)] transition-colors', isActive('/state') ? 'text-[var(--color-primary)]' : 'text-[var(--color-text-secondary)]']}>States</a>
        <a href="/rankings" class:list={['hover:text-[var(--color-primary)] transition-colors', isActive('/rankings') ? 'text-[var(--color-primary)]' : 'text-[var(--color-text-secondary)]']}>Rankings</a>
        <a href="/compare" class:list={['hover:text-[var(--color-primary)] transition-colors', isActive('/compare') ? 'text-[var(--color-primary)]' : 'text-[var(--color-text-secondary)]']}>Compare</a>
        <a href="/calculator" class:list={['hover:text-[var(--color-primary)] transition-colors', isActive('/calculator') ? 'text-[var(--color-primary)]' : 'text-[var(--color-text-secondary)]']}>Calculator</a>
        <a href="/about" class:list={['hover:text-[var(--color-primary)] transition-colors', isActive('/about') ? 'text-[var(--color-primary)]' : 'text-[var(--color-text-secondary)]']}>About</a>
      </nav>

      <div class="flex items-center gap-2">
        <form action="/search" method="get" class="hidden sm:flex items-center">
          <div class="relative">
            <input
              type="text"
              name="q"
              placeholder="Search metros..."
              class="w-40 lg:w-52 h-8 pl-8 pr-3 text-sm rounded-lg border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text)] placeholder-[var(--color-text-secondary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent"
            />
            <svg class="absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-[var(--color-text-secondary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
        </form>

        <button id="theme-toggle" class="p-2 rounded-lg hover:bg-[var(--color-surface)] transition-colors" aria-label="Toggle theme">
          <svg class="w-5 h-5 text-[var(--color-text-secondary)] dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
          <svg class="w-5 h-5 text-[var(--color-text-secondary)] hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
        </button>

        <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-[var(--color-surface)] transition-colors" aria-label="Toggle menu">
          <svg class="w-5 h-5 text-[var(--color-text-secondary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>

    <nav id="mobile-menu" class="hidden md:hidden pb-4 border-t border-[var(--color-border)]">
      <div class="flex flex-col gap-2 pt-3 text-sm font-medium">
        <a href="/metro" class:list={['px-3 py-2 rounded-lg transition-colors', isActive('/metro') ? 'text-[var(--color-primary)] bg-[var(--color-surface)]' : 'text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]']}>Metros</a>
        <a href="/state" class:list={['px-3 py-2 rounded-lg transition-colors', isActive('/state') ? 'text-[var(--color-primary)] bg-[var(--color-surface)]' : 'text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]']}>States</a>
        <a href="/rankings" class:list={['px-3 py-2 rounded-lg transition-colors', isActive('/rankings') ? 'text-[var(--color-primary)] bg-[var(--color-surface)]' : 'text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]']}>Rankings</a>
        <a href="/compare" class:list={['px-3 py-2 rounded-lg transition-colors', isActive('/compare') ? 'text-[var(--color-primary)] bg-[var(--color-surface)]' : 'text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]']}>Compare</a>
        <a href="/calculator" class:list={['px-3 py-2 rounded-lg transition-colors', isActive('/calculator') ? 'text-[var(--color-primary)] bg-[var(--color-surface)]' : 'text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]']}>Calculator</a>
        <a href="/about" class:list={['px-3 py-2 rounded-lg transition-colors', isActive('/about') ? 'text-[var(--color-primary)] bg-[var(--color-surface)]' : 'text-[var(--color-text-secondary)] hover:bg-[var(--color-surface)]']}>About</a>
      </div>
      <form action="/search" method="get" class="mt-3 sm:hidden">
        <div class="relative">
          <input
            type="text"
            name="q"
            placeholder="Search metros..."
            class="w-full h-9 pl-8 pr-3 text-sm rounded-lg border border-[var(--color-border)] bg-[var(--color-surface)] text-[var(--color-text)] placeholder-[var(--color-text-secondary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] focus:border-transparent"
          />
          <svg class="absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-[var(--color-text-secondary)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </div>
      </form>
    </nav>
  </div>

  <script is:inline>
    document.getElementById('theme-toggle').addEventListener('click', function() {
      document.documentElement.classList.toggle('dark');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    });
    document.getElementById('mobile-menu-btn').addEventListener('click', function() {
      var menu = document.getElementById('mobile-menu');
      if (menu.classList.contains('hidden')) {
        menu.classList.remove('hidden');
      } else {
        menu.classList.add('hidden');
      }
    });
  </script>
</header>
