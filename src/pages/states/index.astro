---
import Base from '../../layouts/Base.astro';
import { getAllStates, formatRpp } from '../../lib/db';

const db = Astro.locals.runtime.env.DB;
const states = await getAllStates(db);
---

<Base
  title="Cost of Living by State"
  description="Compare cost of living across all U.S. states using BEA Regional Price Parities. See goods, services, and rent indices."
  breadcrumbs={[{ name: 'Home', href: '/' }, { name: 'States' }]}
>
  <section class="max-w-6xl mx-auto px-4 py-8">
    <div class="mb-2 text-sm text-[var(--color-text-secondary)]">
      <a href="/" class="hover:text-[var(--color-primary)]">Home</a> /
    </div>
    <h1 class="text-2xl md:text-3xl font-bold mb-2">Cost of Living by State</h1>
    <p class="text-[var(--color-text-secondary)] mb-6">{states.length} states &middot; National average = 100</p>

    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-[var(--color-border)] text-left text-[var(--color-text-secondary)]">
            <th class="pb-2 font-medium">State</th>
            <th class="pb-2 font-medium text-right">Overall</th>
            <th class="pb-2 font-medium text-right hidden sm:table-cell">Goods</th>
            <th class="pb-2 font-medium text-right hidden sm:table-cell">Services</th>
            <th class="pb-2 font-medium text-right hidden md:table-cell">Rents</th>
            <th class="pb-2 font-medium text-right">Metros</th>
          </tr>
        </thead>
        <tbody>
          {states.map(state => (
            <tr class="border-b border-[var(--color-border)] hover:bg-[var(--color-surface)] transition-colors">
              <td class="py-3">
                <a href={`/state/${state.slug}`} class="text-[var(--color-primary)] hover:underline font-medium">{state.name}</a>
              </td>
              <td class="py-3 text-right">
                <span class={state.rpp_all >= 100 ? 'text-amber-600 dark:text-amber-400' : 'text-teal-600 dark:text-teal-400'}>{formatRpp(state.rpp_all)}</span>
              </td>
              <td class="py-3 text-right hidden sm:table-cell">{formatRpp(state.rpp_goods)}</td>
              <td class="py-3 text-right hidden sm:table-cell">{formatRpp(state.rpp_services)}</td>
              <td class="py-3 text-right hidden md:table-cell">{formatRpp(state.rpp_rents)}</td>
              <td class="py-3 text-right text-[var(--color-text-secondary)]">{state.msa_count}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </section>
</Base>
